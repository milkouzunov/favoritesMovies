{"ast":null,"code":"var _jsxFileName = \"/media/uzunov/78604C4A604C1174/favorites-movies/src/Components/Details/Details.js\",\n    _s = $RefreshSig$();\n\nimport { useContext, useEffect, useState } from \"react\";\nimport Parser from 'html-react-parser';\nimport StarRatings from \"react-star-ratings\";\nimport { Link } from \"@material-ui/core\";\nimport Comments from \"./Comments/Comments\";\nimport { getById } from \"../../services/movieService\";\nimport * as favoriteService from \"../../services/favoriteService\";\nimport * as reviewService from '../../services/reviewService';\nimport { useDispatch, useSelector } from 'react-redux';\nimport AuthContext from \"../../contexts/AuthContext\";\nimport { getMovieRequest } from \"../../reducers/moviesReducer\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Details({\n  match\n}) {\n  _s();\n\n  const username = useContext(AuthContext);\n  const [movie, setMovie] = useState({});\n  const [isFavorite, setIsFavorite] = useState(false);\n  const [rating, setRating] = useState(0);\n  const [isUserRating, setIsUserRating] = useState(false);\n  const dispatch = useDispatch();\n  const movieId = match.params.id;\n  useEffect(() => {\n    dispatch(getMovieRequest(movieId));\n  }, [movieId]);\n  const movies = useSelector(state => state.movie.movie);\n  useEffect(() => {\n    const movieId = match.params.id;\n    getById(movieId).then(res => {\n      return res.json();\n    }).then(movie => {\n      setMovie(movie);\n\n      if (movie.ratings) {\n        const rating = movie.ratings.reduce((acc, c) => acc + Number(c.rating), 0) / movie.ratings.length;\n        setRating(rating);\n        const userRating = movie.ratings.some(r => r.username == username);\n\n        if (userRating) {\n          setIsUserRating(false);\n        } else {\n          setIsUserRating(true);\n        }\n      } else {\n        setIsUserRating(true);\n      }\n    }).catch(error => console.error(error));\n  }, [rating]);\n  useEffect(() => {\n    if (username) {\n      favoriteService.get().then(res => {\n        return res.json();\n      }).then(favorites => {\n        if (favorites.length > 0) {\n          const isFavorite = favorites.some(x => x.movieId == movie.id);\n\n          if (isFavorite) {\n            setIsFavorite(true);\n          }\n        }\n      }).catch(error => console.log(error));\n    }\n  }, [movie]);\n\n  const addFavorite = e => {\n    e.preventDefault();\n    const addMovie = Object.assign({}, {\n      movieId: movie.id,\n      name: movie.name,\n      genres: movie.genres,\n      runtime: movie.runtime,\n      officialSite: movie.officialSite,\n      summary: movie.summary,\n      imageUrl: movie.imageUrl\n    });\n    favoriteService.add(addMovie).then(res => {\n      if (res.ok) {\n        setIsFavorite(true);\n      }\n    }).catch(error => console.log(error));\n  };\n\n  const removeFavorite = e => {\n    e.preventDefault();\n    favoriteService.remove(movie.id).then(res => {\n      if (res.ok) {\n        setIsFavorite(false);\n      }\n    }).catch(error => console.log(error));\n  };\n\n  const changeRating = async (newRating, name) => {\n    try {\n      await reviewService.addRatings({\n        rating: newRating,\n        username: name,\n        movieId: movie.id\n      });\n      setIsUserRating(false);\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"section\", {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"card\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"card-image\",\n        style: {\n          backgroundImage: `url(${movie.imageUrl})`\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"card-content\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: movie.name\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 147,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [movie.genres ? movie.genres.join(', ') : null, \" | \", movie.runtime, \" minutes\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 11\n        }, this), (movie === null || movie === void 0 ? void 0 : movie.summary) ? Parser(movie.summary) : /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Not Summary\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 149,\n          columnNumber: 53\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: /*#__PURE__*/_jsxDEV(Link, {\n            style: {\n              cursor: \"pointer\"\n            },\n            onClick: e => {\n              e.preventDefault();\n              window.location.href = movie.officialSite;\n            },\n            children: \"Visit official site\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 151,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 150,\n          columnNumber: 11\n        }, this), username ? /*#__PURE__*/_jsxDEV(Link, {\n          onClick: isFavorite ? removeFavorite : addFavorite,\n          className: isFavorite ? \"button-favorite remove-favorite\" : \"button-favorite add-favorite\",\n          children: isFavorite ? 'Remove From Favorite' : 'Add To Favorite'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 163,\n          columnNumber: 23\n        }, this) : null]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 146,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          left: 16,\n          position: \"absolute\",\n          marginTop: \"22em\"\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          children: \"Your Rating\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 177,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(StarRatings, {\n          rating: rating,\n          starSelectingHoverColor: \"rgb(251 251 5)\",\n          starRatedColor: \"#e6e63a\",\n          isAggregateRating: \"true\",\n          changeRating: isUserRating && username ? changeRating : null,\n          numberOfStars: 5,\n          name: username\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 178,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          position: \"absolute\",\n          marginTop: \"31em\"\n        },\n        children: /*#__PURE__*/_jsxDEV(Comments, {\n          movieComments: movie.comments,\n          movieId: movie.id\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"style\", {\n      jsx: true,\n      children: `\n          .button-favorite {\n            background-color: #ffffff;\n            size: 2px;\n            display: inline-block;\n            font-weight: 400;\n            text-align: center;\n            vertical-align: middle;\n            text-decoration: none;\n            border: 3px solid;\n            padding: 0.375rem 1rem;\n            font-size: 20px;\n            line-height: 1.5;\n            border-radius: 0.25rem;\n            box-shadow: \"0px 10px 13px -7px #000000, 0px -15px 0px -12px rgba(0,0,0,0)\";\n            transition: \"color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out\";\n          }\n          .add-favorite {\n            border-color: #33a64c;\n            color: #33a64c;\n          }\n          .add-favorite:hover {\n            background-color: #33a64c;\n            border-color: #33a64c;\n            color: #ffffff;\n            cursor: pointer;\n          }\n          .remove-favorite {\n            border-color: #cc0000;\n            color: #cc0000;\n          }\n          .remove-favorite:hover {\n            background-color: #cc0000;\n            border-color: #cc0000;\n            color: #ffffff;\n            cursor: pointer;\n          }\n          .card {\n            margin: 10px;\n            width: 100%;\n            text-align: left;\n            display: flex;\n            flex-direction: row;\n\n             {\n              /* box-shadow: 0 2px 4px rgba(0, 0, 0, 0.25);\n            border-radius: 5px; */\n            }\n          }\n\n          .card-image {\n            width: 13%;\n            height: 300px;\n            background-size: 259px 298px;\n          }\n\n          .card-content {\n            width: 50%;\n            padding: 20px 40px;\n          }\n        `\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 141,\n    columnNumber: 5\n  }, this);\n}\n\n_s(Details, \"IIPNUW2MBPib6+0UA5/nYF+2Kdw=\", false, function () {\n  return [useDispatch, useSelector];\n});\n\n_c = Details;\n\nvar _c;\n\n$RefreshReg$(_c, \"Details\");","map":{"version":3,"sources":["/media/uzunov/78604C4A604C1174/favorites-movies/src/Components/Details/Details.js"],"names":["useContext","useEffect","useState","Parser","StarRatings","Link","Comments","getById","favoriteService","reviewService","useDispatch","useSelector","AuthContext","getMovieRequest","Details","match","username","movie","setMovie","isFavorite","setIsFavorite","rating","setRating","isUserRating","setIsUserRating","dispatch","movieId","params","id","movies","state","then","res","json","ratings","reduce","acc","c","Number","length","userRating","some","r","catch","error","console","get","favorites","x","log","addFavorite","e","preventDefault","addMovie","Object","assign","name","genres","runtime","officialSite","summary","imageUrl","add","ok","removeFavorite","remove","changeRating","newRating","addRatings","backgroundImage","join","cursor","window","location","href","left","position","marginTop","comments"],"mappings":"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","sourcesContent":["import { useContext, useEffect, useState } from \"react\";\nimport Parser from 'html-react-parser';\n\nimport StarRatings from \"react-star-ratings\";\n\nimport { Link } from \"@material-ui/core\";\nimport Comments from \"./Comments/Comments\";\n\nimport { getById } from \"../../services/movieService\";\nimport * as favoriteService from \"../../services/favoriteService\";\nimport * as reviewService from '../../services/reviewService';\n\nimport { useDispatch, useSelector} from 'react-redux';\n\nimport AuthContext from \"../../contexts/AuthContext\";\nimport { getMovieRequest } from \"../../reducers/moviesReducer\";\n\nexport default function Details({match}) {\n  const username = useContext(AuthContext);\n\n  const [movie, setMovie] = useState({});\n  const [isFavorite, setIsFavorite] = useState(false);\n  const [rating, setRating] = useState(0);\n  const [isUserRating, setIsUserRating] = useState(false);\n\n  const dispatch = useDispatch();\n  \n  const movieId = match.params.id;\n\n  useEffect(() => {\n    dispatch(getMovieRequest(movieId));\n\n  }, [movieId]);\n\n  const movies = useSelector((state) => state.movie.movie)  \n\n  useEffect(() => {\n    const movieId = match.params.id;\n\n    getById(movieId)\n    .then(res => { return res.json(); })\n    .then(movie => {\n      setMovie(movie);\n      \n      if( movie.ratings) {\n        const rating = movie.ratings.reduce((acc, c) => acc + Number(c.rating), 0) / movie.ratings.length;\n        setRating(rating);\n        const userRating = movie.ratings.some(r => r.username == username);\n\n        if(userRating) {\n          setIsUserRating(false);\n        } else {\n          setIsUserRating(true);\n        }\n\n      } else {\n          setIsUserRating(true);\n      }\n      \n\n    })\n    .catch(error => console.error(error));\n\n  }, [rating]); \n\n  useEffect(() => {\n    \n    if(username) {\n      favoriteService.get()\n      .then(res => { return res.json(); })\n      .then((favorites) => {\n        if(favorites.length > 0) {\n          const isFavorite = favorites.some(x => x.movieId == movie.id);\n          if(isFavorite) {\n              setIsFavorite(true);\n          } \n        }\n      })\n      .catch(error => console.log(error));\n    }\n\n  }, [movie]);\n  \n  const addFavorite = (e) => {\n    e.preventDefault();\n    const addMovie = Object.assign(\n        {},\n        {\n          movieId: movie.id,\n          name: movie.name,\n          genres: movie.genres,\n          runtime: movie.runtime,\n          officialSite: movie.officialSite,\n          summary: movie.summary,\n          imageUrl: movie.imageUrl,\n        }\n      );\n      favoriteService.add(addMovie)\n    .then(res => {\n        if(res.ok) {\n            setIsFavorite(true);\n        }\n    })\n    .catch(error => console.log(error));\n  };\n\n  const removeFavorite = (e) => {\n    e.preventDefault();\n    \n    favoriteService.remove(movie.id)\n    .then(res => {\n        if(res.ok) {\n            setIsFavorite(false);\n        }\n    })\n    .catch(error => console.log(error));\n  };\n\n  \n\n  const changeRating = async (newRating, name) => {\n    \n    \n    try {\n      await reviewService.addRatings({\n        rating: newRating,\n        username: name,\n        movieId: movie.id\n      });\n        setIsUserRating(false);\n      \n\n    } catch(error) {\n      console.log(error);\n    }\n\n    \n  };\n  \n  return (\n    <section>\n      <div className=\"card\">\n        <div className=\"card-image\" style={{\n              backgroundImage: `url(${movie.imageUrl})`\n          }}></div>\n        <div className=\"card-content\">\n          <h2>{movie.name}</h2>\n          <p>{movie.genres ? movie.genres.join(', ') : null} | {movie.runtime} minutes</p>\n          {movie?.summary ? Parser(movie.summary) : <p>Not Summary</p>}\n          <p>\n            <Link\n              style={{\n                cursor: \"pointer\",\n              }}\n              onClick={(e) => {\n                e.preventDefault();\n                window.location.href = movie.officialSite;\n              }}\n            >\n              Visit official site\n            </Link>\n          </p>\n          {username ? <Link\n              onClick={isFavorite ? removeFavorite : addFavorite}\n              className={isFavorite ? \"button-favorite remove-favorite\" : \"button-favorite add-favorite\"}\n            >\n              {isFavorite ? 'Remove From Favorite' : 'Add To Favorite'}\n            </Link> : null}\n        </div>\n        <div\n          style={{\n            left: 16,\n            position: \"absolute\",\n            marginTop: \"22em\",\n          }}\n        >\n          <h1>Your Rating</h1>\n          <StarRatings\n            rating={rating}\n            starSelectingHoverColor=\"rgb(251 251 5)\"\n            starRatedColor=\"#e6e63a\"\n            isAggregateRating=\"true\"\n            \n            changeRating={(isUserRating && username) ? changeRating : null}\n            numberOfStars={5}\n            name={username}\n          />\n        </div>\n        <div style={{\n                position: \"absolute\",\n                marginTop: \"31em\"\n        }}>\n          <Comments movieComments={movie.comments} movieId={movie.id}  />\n        </div>\n      </div>\n      <style jsx>\n        {`\n          .button-favorite {\n            background-color: #ffffff;\n            size: 2px;\n            display: inline-block;\n            font-weight: 400;\n            text-align: center;\n            vertical-align: middle;\n            text-decoration: none;\n            border: 3px solid;\n            padding: 0.375rem 1rem;\n            font-size: 20px;\n            line-height: 1.5;\n            border-radius: 0.25rem;\n            box-shadow: \"0px 10px 13px -7px #000000, 0px -15px 0px -12px rgba(0,0,0,0)\";\n            transition: \"color 0.15s ease-in-out, background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out\";\n          }\n          .add-favorite {\n            border-color: #33a64c;\n            color: #33a64c;\n          }\n          .add-favorite:hover {\n            background-color: #33a64c;\n            border-color: #33a64c;\n            color: #ffffff;\n            cursor: pointer;\n          }\n          .remove-favorite {\n            border-color: #cc0000;\n            color: #cc0000;\n          }\n          .remove-favorite:hover {\n            background-color: #cc0000;\n            border-color: #cc0000;\n            color: #ffffff;\n            cursor: pointer;\n          }\n          .card {\n            margin: 10px;\n            width: 100%;\n            text-align: left;\n            display: flex;\n            flex-direction: row;\n\n             {\n              /* box-shadow: 0 2px 4px rgba(0, 0, 0, 0.25);\n            border-radius: 5px; */\n            }\n          }\n\n          .card-image {\n            width: 13%;\n            height: 300px;\n            background-size: 259px 298px;\n          }\n\n          .card-content {\n            width: 50%;\n            padding: 20px 40px;\n          }\n        `}\n      </style>\n    </section>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}